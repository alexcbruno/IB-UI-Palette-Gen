<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 16px;
        padding: 1rem;
      }

      .heading {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 2rem;
        border-bottom: 0.0625rem solid black;
      }

      h1 {
        margin: 0;
      }

      #generateBtn {
        margin: 0 0 2rem 0;
      }

      .field-container {
        display: flex;
        flex-direction: row;
        gap: 2rem;
      }

      .text-entry {
        display: flex;
        flex-direction: column;
        flex-basis: 50%;
        gap: 1rem;
        div {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }
      }

      .generatedJson {
        flex-basis: 50%;
        display: flex;
        flex-direction: column;
      }

      #generatedJson {
        border: 0.0625rem solid #999;
        border-radius: 1rem;
        background-color: #f1f1f1;
        min-height: 8rem;
      }
    </style>
  </head>
  <body>
    <section class="heading">
      <h1>Palette Generator</h1>
      <button id="generateBtn" style="margin-bottom: 16px">
        Generate Palette
      </button>
    </section>

    <select id="designSystemSelector">
      <!-- Options will be dynamically inserted here -->
    </select>

    <div class="text-entry">
        <p>Please select a design system color palette to get started.</p>
    </div>

      <div class="generatedJson">
        <label for="generatedJson">Palette Output</label>
        <pre id="generatedJson"></pre>
      </div>
    </div>

    <script>
      // On UI load, request the list of design systems from the plugin
      window.onload = () => {
        parent.postMessage(
          { pluginMessage: { type: "request-design-systems" } },
          "*"
        );
      };

      // When a design system is selected, request its colors and steps
      document
        .getElementById("designSystemSelector")
        .addEventListener("change", (event) => {
          parent.postMessage(
            {
              pluginMessage: {
                type: "design-system-selected",
                systemName: event.target.value,
              },
            },
            "*"
          );
        });

      document.getElementById("generateBtn").onclick = () => {
        const colorInputs = document.querySelectorAll(".hexColor");
        const colors = Array.from(colorInputs)
          .map((input) => ({
            name: input.dataset.colorName, // Extract the color name from the data attribute
            hex: input.value,
            step: input.dataset.colorStep, // Extract the color step from the data attribute
          }))
          .filter((color) => color.hex !== "");

        parent.postMessage(
          { pluginMessage: { type: "generate-palettes", colors: colors } },
          "*"
        );
      };

      window.onmessage = (event) => {
    const message = event.data.pluginMessage;

    if (message.type === "set-design-systems") {
        const selector = document.getElementById("designSystemSelector");
        // Add a default "Select design system" option
        selector.innerHTML = `<option value="" disabled selected>Select design system</option>` + 
            message.designSystems
                .map((name) => `<option value="${name}">${name}</option>`)
                .join("");
    } else if (message.type === "set-design-system-colors") {
      const colorsContainer = document.querySelector(".text-entry"); // Assuming .text-entry is where you want to append the color inputs
      colorsContainer.innerHTML = ""; // Clear existing fields

      message.systemConfig.colors.forEach((color) => {
        // Create the div, label, and input for each color
        const colorDiv = document.createElement("div");
        const label = document.createElement("label");
        label.setAttribute("for", color.name);
        label.textContent = color.name;

        const input = document.createElement("input");
        input.setAttribute("type", "text");
        input.className = "hexColor";
        input.id = color.name;
        input.placeholder = "#";

        // Append the label and input to the div
        colorDiv.appendChild(label);
        colorDiv.appendChild(input);

        // Append the div to the colors container
        colorsContainer.appendChild(colorDiv);
      });
    } else if (message.type === "generated-palettes") {
      document.getElementById("generatedJson").textContent = JSON.stringify(
        message.palettes,
        null,
        2
      );
    }
  };
    </script>
  </body>
</html>
